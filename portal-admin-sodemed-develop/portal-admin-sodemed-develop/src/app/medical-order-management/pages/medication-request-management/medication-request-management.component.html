<main class="tw-mb-1">
  <header>
    <h2 class="">Gestión de solicitudes médicas </h2>
  </header>

  <section class="card tw-p-2  tw-flex-col">
    <app-filter-medical-request [loadingSearch]="loadingSearch" (onSearch)="searchResults($event)"
      (onCleanFilter)="cleanFilter()" />
  </section>
  <section class="card tw-p-2 tw-flex tw-flex-col" style="min-height: calc(100vh - 316px);">
    @if(this.reponseOrderToManagement?.length>0) {
    <section>
      <p-button [icon]="loadingDownload ?  'pi pi-spin pi-spinner' : 'pi pi-external-link'"
        label="Exportar datos" (onClick)="exportData()" />
    </section>
    }
    <app-table-base-styles>
      <p-table p-table-base [value]="reponseOrderToManagement" [scrollable]="true" [scrollHeight]="'400px'"
        responsiveLayout="stack" [breakpoint]="'960px'" [tableStyle]="{'min-width': '50rem'}">
        <ng-template pTemplate="header">
          <tr>
            <th>ID</th>
            <th>Identificación</th>
            <th>Nombre</th>
            <th>Fecha de creación</th>
            <th>Estado</th>
            <th>
              <i class="pi pi-cog tw-text-lg"></i>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-order>
          <tr>
            <td>{{ order.id }} </td>
            <td>{{ order.userOrderIdentification }}</td>
            <td>{{ order.userOrderName }}</td>
            <td>{{ order.creationDate | date :'medium'}}</td>
            <td>
              <span
                class="status__order {{order?.statusOrder}} tw-inline-block tw-rounded-full tw-py-3 tw-px-4 tw-min-w-full"
                [ngStyle]="order?.statusOrder | getStylesStatusOrder">
                {{ order.statusOrder | dictionaryStatusOrder}}
              </span>
            </td>
            <td>
              <span>
                <p-button label="Gestionar solicitud" icon="pi pi-cog" [outlined]="true"
                  (click)="getMedicalRequestById(order)" />
              </span>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </app-table-base-styles>
    @if (reponseOrderToManagement.length === 0) {
    <div class="tw-h-full tw-flex-grow tw-flex tw-justify-center tw-items-center">
      <div class="tw-text-center">
        <p class="tw-font-bold tw-text-2xl tw-text-stone-600 my-1">No se encontraron resultados.</p>
        <p class="tw-text-stone-600 my-1">En este momento no cuenta con ninguna orden</p>
      </div>
    </div>
    }
    @if (reponseOrderToManagement.length > 0 && paginator.totalPages > 1) {
    <section class="section__paginator">
      <div class="tw-flex tw-justify-center">
        <p-paginator (onPageChange)="onPageChange1($event)" [first]="paginator.page-1" [rows]="paginator.row"
          [totalRecords]="paginator.totalRecords" [showFirstLastIcon]="false" />
      </div>
    </section>
    }
  </section>
</main>

<p-dialog header="Detalle solicitud medica" [(visible)]="showDialog" [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '100%' }" [style]="{ width: '50vw' }" [draggable]="false"
  [resizable]="false">
  @if (medicalRequestDetail && showDialog) {
  <app-detail-medical-request [medicalRequestDetails]="medicalRequestDetail"
    [movementsMedicalRequest]="movementsMedicalRequest" [showDialogSetUpManagement]="showDialogSetUpManagement"
    [loadingSetUpManagement]="loadingSetUpManagement" (onSetUpManagement)="setUpManagement($event)"
    (onCancelManagement)="cancelManagement()" (onGetResource)="getResource($event)" />
  }
  <ng-template pTemplate="footer">
    <section class="option__butons tw-flex tw-justify-center  tw-gap-3 tw-mt-1">
      <div class="tw-w-full">
        <p-button styleClass="tw-w-full" label="Cerrar" [text]="true" severity="secondary" (click)="closet()" />
      </div>
      <div class="tw-w-full">
        <p-button styleClass="tw-w-full" label="Gestionar" (click)="showDialogManagement()" />
      </div>
    </section>
  </ng-template>
</p-dialog>